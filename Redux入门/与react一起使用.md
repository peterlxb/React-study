# use with React
首先安装

```JavaScript
  npm install --save react-redux
```
以todo app为例。
第一个要明白的概念“Presentational and Container Components”
[原文地址]:(https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)

<table>
    <thead>
        <tr>
            <th></th>
            <th scope="col" style="text-align:left">Presentational Components</th>
            <th scope="col" style="text-align:left">Container Components</th>
        </tr>
    </thead>
    <tbody>
        <tr>
          <th scope="row" style="text-align:right">Purpose</th>
          <td>How things look (markup, styles)</td>
          <td>How things work (data fetching, state updates)</td>
        </tr>
        <tr>
          <th scope="row" style="text-align:right">Aware of Redux</th>
          <td>No</th>
          <td>Yes</th>
        </tr>
        <tr>
          <th scope="row" style="text-align:right">To read data</th>
          <td>Read data from props</td>
          <td>Subscribe to Redux state</td>
        </tr>
        <tr>
          <th scope="row" style="text-align:right">To change data</th>
          <td>Invoke callbacks from props</td>
          <td>Dispatch Redux actions</td>
        </tr>
        <tr>
          <th scope="row" style="text-align:right">Are written</th>
          <td>By hand</td>
          <td>Usually generated by React Redux</td>
        </tr>
    </tbody>
</table>

我们所编写的主要都是presentational组件。也需要编写几个container组件来与Redux store连接。
虽然可以通过store.subscribe()首先container component,因为React Redux做了很多性能方面的改进，不建议直接自己手写，而是使用React Redux提供的connect()方法。

## 第一步 Designing Presentational Components 设计显示组件
有如下的结构

* **`TodoList`** is a list showing visible todos.
  - `todos: Array` is an array of todo items with `{ id, text, completed }` shape.
  - `onTodoClick(id: number)` is a callback to invoke when a todo is clicked.
* **`Todo`** is a single todo item.
  - `text: string` is the text to show.
  - `completed: boolean` is whether the todo should appear crossed out.
  - `onClick()` is a callback to invoke when the todo is clicked.
* **`Link`** is a link with a callback.
  - `onClick()` is a callback to invoke when the link is clicked.
* **`Footer`** is where we let the user change currently visible todos.
* **`App`** is the root component that renders everything else.
上面的组件只是用来描述app长什么样，数据从哪里来还不知道以及如何改变。它们只会渲染给它们的数据。
这些组件对Redux没有依赖。

## Designing Container Components 设计容器组件
同样我们也需要几个container Components来使Presentational Components与Redux连接在一起。
例如在Presentational Components中的TodoList组件需要一个像VisibleTodoList这样的容器。
以及为了改变visibility filter，需要提供FilterLink容器用来render一个当点击时派发一个action的Link。

* **`VisibleTodoList`** filters the todos according to the current visibility filter and renders a `TodoList`.
* **`FilterLink`** gets the current visibility filter and renders a `Link`.
  - `filter: string` is the visibility filter it represents.
## 设计其他组件
  有时候是设计Presentational 还是container说不准。例如，form表单和函数是绑定在一起
  如todo app中的AddTodo 组件
  当组件很小的时候将presentation and logic混合在一起没有什么问题。
  当它变大后分离的时候更明显。
  * **`AddTodo`** is an input field with an “Add” button


以实际代码为例
components/TodoList.js
暂时先忽略propTypes
```JavaScript
  import React from 'react'
  import PropTypes from 'prop-types'
  import Todo from './Todo'
   
  const TodoList = ({ todos, onTodoClick }) => (
  <ul>
    {todos.map((todo, index) => (
      <Todo key={index} {...todo} onClick={() => onTodoClick(index)} />
    ))}
  </ul>
  )
   
  TodoList.propTypes = {
  todos: PropTypes.arrayOf(
    PropTypes.shape({
      id: PropTypes.number.isRequired,
      completed: PropTypes.bool.isRequired,
      text: PropTypes.string.isRequired
    }).isRequired
  ).isRequired,
  onTodoClick: PropTypes.func.isRequired
  }
   
  export default TodoList
```

connect()
To use connect(), you need to define a special function called mapStateToProps that tells how to transform the current Redux store state into the props you want to pass to a presentational component you are wrapping.
为了使用connect,需要定义一个特殊的函数mapStateToProps，这个函数可用于将当前的Redux store state传递给被包裹的Presentational component。
比如下面的mapStateToProps，VisibleTodoList组件需要计算todos然后传递给TodoList组件。所以定义了一个根据state.visibilityFilter来过滤
state.todos的函数。在mapStateToProps()中直接调用。

为了读取state，container components 可以dispatch actions。使用mapDispatchToProps() 函数。
比如往TodoList注入onTodoClick属性，而且这个onTodoClick派发一个TOGGLE_TODO action。

containers/VisibleTodoList.js
```JavaScript
  import { connect } from 'react-redux'
  import { toggleTodo } from '../actions'
  import TodoList from '../components/TodoList'
   
  const getVisibleTodos = (todos, filter) => {
    switch (filter) {
      case 'SHOW_ALL':
        return todos
      case 'SHOW_COMPLETED':
        return todos.filter(t => t.completed)
      case 'SHOW_ACTIVE':
        return todos.filter(t => !t.completed)
    }
  }
   
  const mapStateToProps = state => {
    return {
      todos: getVisibleTodos(state.todos, state.visibilityFilter)
    }
  }
   
  const mapDispatchToProps = dispatch => {
    return {
      onTodoClick: id => {
        dispatch(toggleTodo(id))
      }
    }
  }
   
  const VisibleTodoList = connect(
    mapStateToProps,
    mapDispatchToProps
  )(TodoList)
   
  export default VisibleTodoList
```
components/Link.js

```JavaScript
import React from 'react'
import PropTypes from 'prop-types'
 
const Link = ({ active, children, onClick }) => {
  if (active) {
    return <span>{children}</span>
  }
 
return (
  <a
    href=""
    onClick={e => {
      e.preventDefault()
      onClick()
    }}
  >
    {children}
  </a>
)
}
 
Link.propTypes = {
  active: PropTypes.bool.isRequired,
  children: PropTypes.node.isRequired,
  onClick: PropTypes.func.isRequired
}
 
export default Link
```
containers/FilterLink.js

```JavaScript
import { connect } from 'react-redux'
import { setVisibilityFilter } from '../actions'
import Link from '../components/Link'
 
const mapStateToProps = (state, ownProps) => {
  return {
    active: ownProps.filter === state.visibilityFilter
  }
}
 
const mapDispatchToProps = (dispatch, ownProps) => {
  return {
    onClick: () => {
      dispatch(setVisibilityFilter(ownProps.filter))
    }
  }
}
 
const FilterLink = connect(
  mapStateToProps,
  mapDispatchToProps
)(Link)
 
export default FilterLink
```
containers/AddTodo.js
```JavaScript
import React from 'react'
import { connect } from 'react-redux'
import { addTodo } from '../actions'
 
let AddTodo = ({ dispatch }) => {
  let input
 
  return (
    <div>
      <form
        onSubmit={e => {
          e.preventDefault()
          if (!input.value.trim()) {
            return
          }
          dispatch(addTodo(input.value))
          input.value = ''
        }}
      >
        <input
          ref={node => {
            input = node
          }}
        />
        <button type="submit">
          Add Todo
        </button>
      </form>
    </div>
  )
}
AddTodo = connect()(AddTodo)
 
export default AddTodo
```
### Passing the Store
React Redux提供了一个组件Provider,通过这个组件可以使得应用中的所欲container组件都能获取到store。
而且只需要使用一次。
index.js 示例

```JavaScript
import React from 'react'
import { render } from 'react-dom'
import { Provider } from 'react-redux'
import { createStore } from 'redux'
import todoApp from './reducers'
import App from './components/App'
 
let store = createStore(todoApp)
 
render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
)
```
